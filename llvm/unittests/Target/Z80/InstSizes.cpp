#include "Z80Subtarget.h"
#include "Z80TargetMachine.h"
#include "llvm/ADT/STLArrayExtras.h"
#include "llvm/ADT/StringRef.h"
#include "llvm/ADT/Triple.h"
#include "llvm/CodeGen/MIRParser/MIRParser.h"
#include "llvm/CodeGen/MachineFunction.h"
#include "llvm/CodeGen/MachineModuleInfo.h"
#include "llvm/IR/Function.h"
#include "llvm/IR/LLVMContext.h"
#include "llvm/IR/Module.h"
#include "llvm/MC/TargetRegistry.h"
#include "llvm/Support/FormatAdapters.h"
#include "llvm/Support/FormatVariadic.h"
#include "llvm/Support/MemoryBuffer.h"
#include "llvm/Support/TargetSelect.h"
#include "llvm/Support/raw_ostream.h"
#include "llvm/Target/TargetMachine.h"
#include <array>
#include <utility>

#include "gtest/gtest.h"

using namespace llvm;

namespace {
struct Counter : FormatAdapter<std::pair<std::string, int &>> {
  Counter(StringRef Prefix, int &Counter)
      : FormatAdapter<std::pair<std::string, int &>>(
            {std::string(Prefix), Counter}) {}
  void format(raw_ostream &S, StringRef O) override {
    S << Item.first << Item.second;
    if (O == "+")
      ++Item.second;
  }
};

template <typename T, size_t N = 2> class SplatArray : public std::array<T, N> {
  using Base = std::array<T, N>;

  template <size_t... I>
  constexpr SplatArray(T A, std::index_sequence<I...>)
      : Base{{(static_cast<void>(I), A)...}} {}

public:
  constexpr SplatArray(T A) : SplatArray(A, std::make_index_sequence<N>{}) {}
  template <typename... Args>
  constexpr SplatArray(Args &&...A) : Base{{std::forward<Args>(A)...}} {}
};

constexpr struct TestInstr {
  SplatArray<const char *, 2> MIR;
  SplatArray<unsigned, 2> Size;
} TestInstrs[] = {
#define w "{0}"
#define l "{1}"
#define u(r) "${2}" #r
#define csr " csr_{3}z80_c"
#define bb " %{4}"
#define def_bb "\n\n  {4:+}:"
#define nz " 0"
#define z " 1"
#define nc " 2"
#define c " 3"
#define po " 4"
#define pe " 5"
#define p " 6"
#define m " 7"
#define imp_def(r) " implicit-def $" #r
#define imp_def_u(r) " implicit-def " u(r)
#define imp(r) " implicit $" #r
#define imp_u(r) " implicit " u(r)
    {"NOP", 1u},
    {u(bc) " = LD" w "ri i" w " 0", {3u, 4u}},
    {"LD8pa " u(bc) "," imp(a), 1u},
    {u(bc) " = INC" w "r " u(bc) "", 1u},
    {"$b = INC8r $b," imp_def(f), 1u},
    {"$b = DEC8r $b," imp_def(f), 1u},
    {"$b = LD8ri i8 0", 2u},
    {"RLCA" imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"EXAF" imp_def(af) "," imp(af), 1u},
    {u(hl) " = ADD" w "ao " u(hl) ", " u(bc) "," imp_def(f), 1u},
    {"LD8ap " u(bc) "," imp_def(a), 1u},
    {u(bc) " = DEC" w "r " u(bc) "", 1u},
    {"$c = INC8r $c," imp_def(f), 1u},
    {"$c = DEC8r $c," imp_def(f), 1u},
    {"$c = LD8ri i8 0", 2u},
    {"RRCA" imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"DJNZ" bb "," imp_def(b) "," imp(b) def_bb, 2u},
    {u(de) " = LD" w "ri i" w " 0", {3u, 4u}},
    {"LD8pa " u(de) "," imp(a), 1u},
    {u(de) " = INC" w "r " u(de) "", 1u},
    {"$d = INC8r $d," imp_def(f), 1u},
    {"$d = DEC8r $d," imp_def(f), 1u},
    {"$d = LD8ri i8 0", 2u},
    {"RLA" imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"JR" bb def_bb, 2u},
    {u(hl) " = ADD" w "ao " u(hl) ", " u(de) "," imp_def(f), 1u},
    {"LD8ap " u(de) "," imp_def(a), 1u},
    {u(de) " = DEC" w "r " u(de) "", 1u},
    {"$e = INC8r $e," imp_def(f), 1u},
    {"$e = DEC8r $e," imp_def(f), 1u},
    {"$e = LD8ri i8 0", 2u},
    {"RRA" imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"JRCC" bb "," nz "," imp(f) def_bb, 2u},
    {u(hl) " = LD" w "ri i" w " 0", {3u, 4u}},
    {"LD" w "ma 0, " u(hl) "", {3u, 4u}},
    {u(hl) " = INC" w "r " u(hl) "", 1u},
    {"$h = INC8r $h," imp_def(f), 1u},
    {"$h = DEC8r $h," imp_def(f), 1u},
    {"$h = LD8ri i8 0", 2u},
    {"DAA" imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"JRCC" bb "," z "," imp(f) def_bb, 2u},
    {u(hl) " = ADD" w "aa " u(hl) "," imp_def(f), 1u},
    {u(hl) " = LD" w "am 0", {3u, 4u}},
    {u(hl) " = DEC" w "r " u(hl) "", 1u},
    {"$l = INC8r $l," imp_def(f), 1u},
    {"$l = DEC8r $l," imp_def(f), 1u},
    {"$l = LD8ri i8 0", 2u},
    {"CPL" imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"JRCC" bb "," nc "," imp(f) def_bb, 2u},
    {"LD" w "si i" w " 0," imp_def(sp) l, {3u, 4u}},
    {"LD8ma 0," imp(a), {3u, 4u}},
    {"INC" w "s" imp_def(sp) l "," imp(sp) l, 1u},
    {"INC8p " u(hl) "," imp_def(f), 1u},
    {"DEC8p " u(hl) "," imp_def(f), 1u},
    {"LD8pi " u(hl) ", i8 0", 2u},
    {"SCF" imp_def(f), 1u},
    {"JRCC" bb "," c "," imp(f) def_bb, 2u},
    {u(hl) " = ADD" w "as " u(hl) "," imp_def(f) "," imp(sp) l, 1u},
    {"LD8am 0," imp_def(a), {3u, 4u}},
    {"DEC" w "s" imp_def(sp) l "," imp(sp) l, 1u},
    {"$a = INC8r $a," imp_def(f), 1u},
    {"$a = DEC8r $a," imp_def(f), 1u},
    {"$a = LD8ri i8 0", 2u},
    {"CCF" imp_def(f) "," imp(f), 1u},
    {"$b = LD8gg $b", 1u},
    {"$b = LD8gg $c", 1u},
    {"$b = LD8gg $d", 1u},
    {"$b = LD8gg $e", 1u},
    {"$b = LD8gg $h", 1u},
    {"$b = LD8gg $l", 1u},
    {"$b = LD8gp " u(hl) "", 1u},
    {"$b = LD8gg $a", 1u},
    {"$c = LD8gg $b", 1u},
    {"$c = LD8gg $c", 1u},
    {"$c = LD8gg $d", 1u},
    {"$c = LD8gg $e", 1u},
    {"$c = LD8gg $h", 1u},
    {"$c = LD8gg $l", 1u},
    {"$c = LD8gp " u(hl) "", 1u},
    {"$c = LD8gg $a", 1u},
    {"$d = LD8gg $b", 1u},
    {"$d = LD8gg $c", 1u},
    {"$d = LD8gg $d", 1u},
    {"$d = LD8gg $e", 1u},
    {"$d = LD8gg $h", 1u},
    {"$d = LD8gg $l", 1u},
    {"$d = LD8gp " u(hl) "", 1u},
    {"$d = LD8gg $a", 1u},
    {"$e = LD8gg $b", 1u},
    {"$e = LD8gg $c", 1u},
    {"$e = LD8gg $d", 1u},
    {"$e = LD8gg $e", 1u},
    {"$e = LD8gg $h", 1u},
    {"$e = LD8gg $l", 1u},
    {"$e = LD8gp " u(hl) "", 1u},
    {"$e = LD8gg $a", 1u},
    {"$h = LD8gg $b", 1u},
    {"$h = LD8gg $c", 1u},
    {"$h = LD8gg $d", 1u},
    {"$h = LD8gg $e", 1u},
    {"$h = LD8gg $h", 1u},
    {"$h = LD8gg $l", 1u},
    {"$h = LD8gp " u(hl) "", 1u},
    {"$h = LD8gg $a", 1u},
    {"$l = LD8gg $b", 1u},
    {"$l = LD8gg $c", 1u},
    {"$l = LD8gg $d", 1u},
    {"$l = LD8gg $e", 1u},
    {"$l = LD8gg $h", 1u},
    {"$l = LD8gg $l", 1u},
    {"$l = LD8gp " u(hl) "", 1u},
    {"$l = LD8gg $a", 1u},
    {"LD8pg " u(hl) ", $b", 1u},
    {"LD8pg " u(hl) ", $c", 1u},
    {"LD8pg " u(hl) ", $d", 1u},
    {"LD8pg " u(hl) ", $e", 1u},
    {"LD8pg " u(hl) ", $h", 1u},
    {"LD8pg " u(hl) ", $l", 1u},
    {"HALT", 1u},
    {"LD8pg " u(hl) ", $a", 1u},
    {"$a = LD8gg $b", 1u},
    {"$a = LD8gg $c", 1u},
    {"$a = LD8gg $d", 1u},
    {"$a = LD8gg $e", 1u},
    {"$a = LD8gg $h", 1u},
    {"$a = LD8gg $l", 1u},
    {"$a = LD8gp " u(hl) "", 1u},
    {"$a = LD8gg $a", 1u},
    {"ADD8ar $b," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"ADD8ar $c," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"ADD8ar $d," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"ADD8ar $e," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"ADD8ar $h," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"ADD8ar $l," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"ADD8ap " u(hl) "," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"ADD8ar $a," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"ADC8ar $b," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"ADC8ar $c," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"ADC8ar $d," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"ADC8ar $e," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"ADC8ar $h," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"ADC8ar $l," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"ADC8ap " u(hl) "," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"ADC8ar $a," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"SUB8ar $b," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"SUB8ar $c," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"SUB8ar $d," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"SUB8ar $e," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"SUB8ar $h," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"SUB8ar $l," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"SUB8ap " u(hl) "," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"SUB8ar $a," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"SBC8ar $b," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"SBC8ar $c," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"SBC8ar $d," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"SBC8ar $e," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"SBC8ar $h," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"SBC8ar $l," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"SBC8ap " u(hl) "," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"SBC8ar $a," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 1u},
    {"AND8ar $b," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"AND8ar $c," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"AND8ar $d," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"AND8ar $e," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"AND8ar $h," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"AND8ar $l," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"AND8ap " u(hl) "," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"AND8ar $a," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"XOR8ar $b," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"XOR8ar $c," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"XOR8ar $d," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"XOR8ar $e," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"XOR8ar $h," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"XOR8ar $l," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"XOR8ap " u(hl) "," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"XOR8ar $a," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"OR8ar $b," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"OR8ar $c," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"OR8ar $d," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"OR8ar $e," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"OR8ar $h," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"OR8ar $l," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"OR8ap " u(hl) "," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"OR8ar $a," imp_def(a) "," imp_def(f) "," imp(a), 1u},
    {"CP8ar $b," imp_def(f) "," imp(a), 1u},
    {"CP8ar $c," imp_def(f) "," imp(a), 1u},
    {"CP8ar $d," imp_def(f) "," imp(a), 1u},
    {"CP8ar $e," imp_def(f) "," imp(a), 1u},
    {"CP8ar $h," imp_def(f) "," imp(a), 1u},
    {"CP8ar $l," imp_def(f) "," imp(a), 1u},
    {"CP8ap " u(hl) "," imp_def(f) "," imp(a), 1u},
    {"CP8ar $a," imp_def(f) "," imp(a), 1u},
    {"RET" w "CC" nz "," imp_def(sp) l "," imp(f) "," imp(sp) l def_bb, 1u},
    {u(bc) " = POP" w "r" imp_def(sp) l "," imp(sp) l, 1u},
    {"JP" w "CC" bb "," nz "," imp(f) def_bb, {3u, 4u}},
    {"JP" w bb def_bb, {3u, 4u}},
    {"CALL" w "CC 0," nz "," csr "," imp(f) "," imp(sp) l, {3u, 4u}},
    {"PUSH" w "r " u(bc) "," imp_def(sp) l "," imp(sp) l, 1u},
    {"ADD8ai 0," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"RST" w " 0," imp_def(sp) l "," imp(sp) l, 1u},
    {"RET" w "CC" z "," imp_def(sp) l "," imp(f) "," imp(sp) l def_bb, 1u},
    {"RET" w imp_def(sp) l "," imp(sp) l def_bb, 1u},
    {"JP" w "CC" bb "," z "," imp(f) def_bb, {3u, 4u}},
    {"$b = RLC8r $b," imp_def(f), 2u},
    {"$c = RLC8r $c," imp_def(f), 2u},
    {"$d = RLC8r $d," imp_def(f), 2u},
    {"$e = RLC8r $e," imp_def(f), 2u},
    {"$h = RLC8r $h," imp_def(f), 2u},
    {"$l = RLC8r $l," imp_def(f), 2u},
    {"RLC8p " u(hl) "," imp_def(f), 2u},
    {"$a = RLC8r $a," imp_def(f), 2u},
    {"$b = RRC8r $b," imp_def(f), 2u},
    {"$c = RRC8r $c," imp_def(f), 2u},
    {"$d = RRC8r $d," imp_def(f), 2u},
    {"$e = RRC8r $e," imp_def(f), 2u},
    {"$h = RRC8r $h," imp_def(f), 2u},
    {"$l = RRC8r $l," imp_def(f), 2u},
    {"RRC8p " u(hl) "," imp_def(f), 2u},
    {"$a = RRC8r $a," imp_def(f), 2u},
    {"$b = RL8r $b," imp_def(f) "," imp(f), 2u},
    {"$c = RL8r $c," imp_def(f) "," imp(f), 2u},
    {"$d = RL8r $d," imp_def(f) "," imp(f), 2u},
    {"$e = RL8r $e," imp_def(f) "," imp(f), 2u},
    {"$h = RL8r $h," imp_def(f) "," imp(f), 2u},
    {"$l = RL8r $l," imp_def(f) "," imp(f), 2u},
    {"RL8p " u(hl) "," imp_def(f) "," imp(f), 2u},
    {"$a = RL8r $a," imp_def(f) "," imp(f), 2u},
    {"$b = RR8r $b," imp_def(f) "," imp(f), 2u},
    {"$c = RR8r $c," imp_def(f) "," imp(f), 2u},
    {"$d = RR8r $d," imp_def(f) "," imp(f), 2u},
    {"$e = RR8r $e," imp_def(f) "," imp(f), 2u},
    {"$h = RR8r $h," imp_def(f) "," imp(f), 2u},
    {"$l = RR8r $l," imp_def(f) "," imp(f), 2u},
    {"RR8p " u(hl) "," imp_def(f) "," imp(f), 2u},
    {"$a = RR8r $a," imp_def(f) "," imp(f), 2u},
    {"$b = SLA8r $b," imp_def(f), 2u},
    {"$c = SLA8r $c," imp_def(f), 2u},
    {"$d = SLA8r $d," imp_def(f), 2u},
    {"$e = SLA8r $e," imp_def(f), 2u},
    {"$h = SLA8r $h," imp_def(f), 2u},
    {"$l = SLA8r $l," imp_def(f), 2u},
    {"SLA8p " u(hl) "," imp_def(f), 2u},
    {"$a = SLA8r $a," imp_def(f), 2u},
    {"$b = SRA8r $b," imp_def(f), 2u},
    {"$c = SRA8r $c," imp_def(f), 2u},
    {"$d = SRA8r $d," imp_def(f), 2u},
    {"$e = SRA8r $e," imp_def(f), 2u},
    {"$h = SRA8r $h," imp_def(f), 2u},
    {"$l = SRA8r $l," imp_def(f), 2u},
    {"SRA8p " u(hl) "," imp_def(f), 2u},
    {"$a = SRA8r $a," imp_def(f), 2u},
    {"$b = SLI8r $b," imp_def(f), 2u},
    {"$c = SLI8r $c," imp_def(f), 2u},
    {"$d = SLI8r $d," imp_def(f), 2u},
    {"$e = SLI8r $e," imp_def(f), 2u},
    {"$h = SLI8r $h," imp_def(f), 2u},
    {"$l = SLI8r $l," imp_def(f), 2u},
    {"SLI8p " u(hl) "," imp_def(f), 2u},
    {"$a = SLI8r $a," imp_def(f), 2u},
    {"$b = SRL8r $b," imp_def(f), 2u},
    {"$c = SRL8r $c," imp_def(f), 2u},
    {"$d = SRL8r $d," imp_def(f), 2u},
    {"$e = SRL8r $e," imp_def(f), 2u},
    {"$h = SRL8r $h," imp_def(f), 2u},
    {"$l = SRL8r $l," imp_def(f), 2u},
    {"SRL8p " u(hl) "," imp_def(f), 2u},
    {"$a = SRL8r $a," imp_def(f), 2u},
    {"BIT8bg 0, $b," imp_def(f), 2u},
    {"BIT8bg 0, $c," imp_def(f), 2u},
    {"BIT8bg 0, $d," imp_def(f), 2u},
    {"BIT8bg 0, $e," imp_def(f), 2u},
    {"BIT8bg 0, $h," imp_def(f), 2u},
    {"BIT8bg 0, $l," imp_def(f), 2u},
    {"BIT8bp 0, " u(hl) "," imp_def(f), 2u},
    {"BIT8bg 0, $a," imp_def(f), 2u},
    {"BIT8bg 1, $b," imp_def(f), 2u},
    {"BIT8bg 1, $c," imp_def(f), 2u},
    {"BIT8bg 1, $d," imp_def(f), 2u},
    {"BIT8bg 1, $e," imp_def(f), 2u},
    {"BIT8bg 1, $h," imp_def(f), 2u},
    {"BIT8bg 1, $l," imp_def(f), 2u},
    {"BIT8bp 1, " u(hl) "," imp_def(f), 2u},
    {"BIT8bg 1, $a," imp_def(f), 2u},
    {"BIT8bg 2, $b," imp_def(f), 2u},
    {"BIT8bg 2, $c," imp_def(f), 2u},
    {"BIT8bg 2, $d," imp_def(f), 2u},
    {"BIT8bg 2, $e," imp_def(f), 2u},
    {"BIT8bg 2, $h," imp_def(f), 2u},
    {"BIT8bg 2, $l," imp_def(f), 2u},
    {"BIT8bp 2, " u(hl) "," imp_def(f), 2u},
    {"BIT8bg 2, $a," imp_def(f), 2u},
    {"BIT8bg 3, $b," imp_def(f), 2u},
    {"BIT8bg 3, $c," imp_def(f), 2u},
    {"BIT8bg 3, $d," imp_def(f), 2u},
    {"BIT8bg 3, $e," imp_def(f), 2u},
    {"BIT8bg 3, $h," imp_def(f), 2u},
    {"BIT8bg 3, $l," imp_def(f), 2u},
    {"BIT8bp 3, " u(hl) "," imp_def(f), 2u},
    {"BIT8bg 3, $a," imp_def(f), 2u},
    {"BIT8bg 4, $b," imp_def(f), 2u},
    {"BIT8bg 4, $c," imp_def(f), 2u},
    {"BIT8bg 4, $d," imp_def(f), 2u},
    {"BIT8bg 4, $e," imp_def(f), 2u},
    {"BIT8bg 4, $h," imp_def(f), 2u},
    {"BIT8bg 4, $l," imp_def(f), 2u},
    {"BIT8bp 4, " u(hl) "," imp_def(f), 2u},
    {"BIT8bg 4, $a," imp_def(f), 2u},
    {"BIT8bg 5, $b," imp_def(f), 2u},
    {"BIT8bg 5, $c," imp_def(f), 2u},
    {"BIT8bg 5, $d," imp_def(f), 2u},
    {"BIT8bg 5, $e," imp_def(f), 2u},
    {"BIT8bg 5, $h," imp_def(f), 2u},
    {"BIT8bg 5, $l," imp_def(f), 2u},
    {"BIT8bp 5, " u(hl) "," imp_def(f), 2u},
    {"BIT8bg 5, $a," imp_def(f), 2u},
    {"BIT8bg 6, $b," imp_def(f), 2u},
    {"BIT8bg 6, $c," imp_def(f), 2u},
    {"BIT8bg 6, $d," imp_def(f), 2u},
    {"BIT8bg 6, $e," imp_def(f), 2u},
    {"BIT8bg 6, $h," imp_def(f), 2u},
    {"BIT8bg 6, $l," imp_def(f), 2u},
    {"BIT8bp 6, " u(hl) "," imp_def(f), 2u},
    {"BIT8bg 6, $a," imp_def(f), 2u},
    {"BIT8bg 7, $b," imp_def(f), 2u},
    {"BIT8bg 7, $c," imp_def(f), 2u},
    {"BIT8bg 7, $d," imp_def(f), 2u},
    {"BIT8bg 7, $e," imp_def(f), 2u},
    {"BIT8bg 7, $h," imp_def(f), 2u},
    {"BIT8bg 7, $l," imp_def(f), 2u},
    {"BIT8bp 7, " u(hl) "," imp_def(f), 2u},
    {"BIT8bg 7, $a," imp_def(f), 2u},
    {"$b = RES8bg 0, $b", 2u},
    {"$c = RES8bg 0, $c", 2u},
    {"$d = RES8bg 0, $d", 2u},
    {"$e = RES8bg 0, $e", 2u},
    {"$h = RES8bg 0, $h", 2u},
    {"$l = RES8bg 0, $l", 2u},
    {"RES8bp 0, " u(hl), 2u},
    {"$a = RES8bg 0, $a", 2u},
    {"$b = RES8bg 1, $b", 2u},
    {"$c = RES8bg 1, $c", 2u},
    {"$d = RES8bg 1, $d", 2u},
    {"$e = RES8bg 1, $e", 2u},
    {"$h = RES8bg 1, $h", 2u},
    {"$l = RES8bg 1, $l", 2u},
    {"RES8bp 1, " u(hl), 2u},
    {"$a = RES8bg 1, $a", 2u},
    {"$b = RES8bg 2, $b", 2u},
    {"$c = RES8bg 2, $c", 2u},
    {"$d = RES8bg 2, $d", 2u},
    {"$e = RES8bg 2, $e", 2u},
    {"$h = RES8bg 2, $h", 2u},
    {"$l = RES8bg 2, $l", 2u},
    {"RES8bp 2, " u(hl), 2u},
    {"$a = RES8bg 2, $a", 2u},
    {"$b = RES8bg 3, $b", 2u},
    {"$c = RES8bg 3, $c", 2u},
    {"$d = RES8bg 3, $d", 2u},
    {"$e = RES8bg 3, $e", 2u},
    {"$h = RES8bg 3, $h", 2u},
    {"$l = RES8bg 3, $l", 2u},
    {"RES8bp 3, " u(hl), 2u},
    {"$a = RES8bg 3, $a", 2u},
    {"$b = RES8bg 4, $b", 2u},
    {"$c = RES8bg 4, $c", 2u},
    {"$d = RES8bg 4, $d", 2u},
    {"$e = RES8bg 4, $e", 2u},
    {"$h = RES8bg 4, $h", 2u},
    {"$l = RES8bg 4, $l", 2u},
    {"RES8bp 4, " u(hl), 2u},
    {"$a = RES8bg 4, $a", 2u},
    {"$b = RES8bg 5, $b", 2u},
    {"$c = RES8bg 5, $c", 2u},
    {"$d = RES8bg 5, $d", 2u},
    {"$e = RES8bg 5, $e", 2u},
    {"$h = RES8bg 5, $h", 2u},
    {"$l = RES8bg 5, $l", 2u},
    {"RES8bp 5, " u(hl), 2u},
    {"$a = RES8bg 5, $a", 2u},
    {"$b = RES8bg 6, $b", 2u},
    {"$c = RES8bg 6, $c", 2u},
    {"$d = RES8bg 6, $d", 2u},
    {"$e = RES8bg 6, $e", 2u},
    {"$h = RES8bg 6, $h", 2u},
    {"$l = RES8bg 6, $l", 2u},
    {"RES8bp 6, " u(hl), 2u},
    {"$a = RES8bg 6, $a", 2u},
    {"$b = RES8bg 7, $b", 2u},
    {"$c = RES8bg 7, $c", 2u},
    {"$d = RES8bg 7, $d", 2u},
    {"$e = RES8bg 7, $e", 2u},
    {"$h = RES8bg 7, $h", 2u},
    {"$l = RES8bg 7, $l", 2u},
    {"RES8bp 7, " u(hl), 2u},
    {"$a = RES8bg 7, $a", 2u},
    {"$b = SET8bg 0, $b", 2u},
    {"$c = SET8bg 0, $c", 2u},
    {"$d = SET8bg 0, $d", 2u},
    {"$e = SET8bg 0, $e", 2u},
    {"$h = SET8bg 0, $h", 2u},
    {"$l = SET8bg 0, $l", 2u},
    {"SET8bp 0, " u(hl), 2u},
    {"$a = SET8bg 0, $a", 2u},
    {"$b = SET8bg 1, $b", 2u},
    {"$c = SET8bg 1, $c", 2u},
    {"$d = SET8bg 1, $d", 2u},
    {"$e = SET8bg 1, $e", 2u},
    {"$h = SET8bg 1, $h", 2u},
    {"$l = SET8bg 1, $l", 2u},
    {"SET8bp 1, " u(hl), 2u},
    {"$a = SET8bg 1, $a", 2u},
    {"$b = SET8bg 2, $b", 2u},
    {"$c = SET8bg 2, $c", 2u},
    {"$d = SET8bg 2, $d", 2u},
    {"$e = SET8bg 2, $e", 2u},
    {"$h = SET8bg 2, $h", 2u},
    {"$l = SET8bg 2, $l", 2u},
    {"SET8bp 2, " u(hl), 2u},
    {"$a = SET8bg 2, $a", 2u},
    {"$b = SET8bg 3, $b", 2u},
    {"$c = SET8bg 3, $c", 2u},
    {"$d = SET8bg 3, $d", 2u},
    {"$e = SET8bg 3, $e", 2u},
    {"$h = SET8bg 3, $h", 2u},
    {"$l = SET8bg 3, $l", 2u},
    {"SET8bp 3, " u(hl), 2u},
    {"$a = SET8bg 3, $a", 2u},
    {"$b = SET8bg 4, $b", 2u},
    {"$c = SET8bg 4, $c", 2u},
    {"$d = SET8bg 4, $d", 2u},
    {"$e = SET8bg 4, $e", 2u},
    {"$h = SET8bg 4, $h", 2u},
    {"$l = SET8bg 4, $l", 2u},
    {"SET8bp 4, " u(hl), 2u},
    {"$a = SET8bg 4, $a", 2u},
    {"$b = SET8bg 5, $b", 2u},
    {"$c = SET8bg 5, $c", 2u},
    {"$d = SET8bg 5, $d", 2u},
    {"$e = SET8bg 5, $e", 2u},
    {"$h = SET8bg 5, $h", 2u},
    {"$l = SET8bg 5, $l", 2u},
    {"SET8bp 5, " u(hl), 2u},
    {"$a = SET8bg 5, $a", 2u},
    {"$b = SET8bg 6, $b", 2u},
    {"$c = SET8bg 6, $c", 2u},
    {"$d = SET8bg 6, $d", 2u},
    {"$e = SET8bg 6, $e", 2u},
    {"$h = SET8bg 6, $h", 2u},
    {"$l = SET8bg 6, $l", 2u},
    {"SET8bp 6, " u(hl), 2u},
    {"$a = SET8bg 6, $a", 2u},
    {"$b = SET8bg 7, $b", 2u},
    {"$c = SET8bg 7, $c", 2u},
    {"$d = SET8bg 7, $d", 2u},
    {"$e = SET8bg 7, $e", 2u},
    {"$h = SET8bg 7, $h", 2u},
    {"$l = SET8bg 7, $l", 2u},
    {"SET8bp 7, " u(hl), 2u},
    {"$a = SET8bg 7, $a", 2u},
    {"CALL" w "CC 0," z "," csr "," imp(f) "," imp(sp) l, {3u, 4u}},
    {"CALL" w " 0," csr "," imp(sp) l, {3u, 4u}},
    {"ADC8ai 0," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"RST" w " 8," imp_def(sp) l "," imp(sp) l, 1u},
    {"RET" w "CC" nc "," imp_def(sp) l "," imp(f) "," imp(sp) l def_bb, 1u},
    {u(de) " = POP" w "r" imp_def(sp) l "," imp(sp) l, 1u},
    {"JP" w "CC" bb "," nc "," imp(f) def_bb, {3u, 4u}},
    {"OUT8ma 0," imp(a), 2u},
    {"CALL" w "CC 0," nc "," csr "," imp(f) "," imp(sp) l, {3u, 4u}},
    {"PUSH" w "r " u(de) "," imp_def(sp) l "," imp(sp) l, 1u},
    {"SUB8ai 0," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"RST" w " 16," imp_def(sp) l "," imp(sp) l, 1u},
    {"RET" w "CC" c "," imp_def(sp) l "," imp(f) "," imp(sp) l def_bb, 1u},
    {"EXX" w imp_def_u(hl) "," imp_def_u(de) "," imp_def_u(bc) "," imp_u(
         hl) "," imp_u(de) "," imp_u(bc),
     1u},
    {"JP" w "CC" bb "," c "," imp(f) def_bb, {3u, 4u}},
    {"IN8am 0," imp_def(a), 2u},
    {"CALL" w "CC 0," c "," csr "," imp(f) "," imp(sp) l, {3u, 4u}},
    {u(bc) " = LD" w "ro " u(ix) ", 0", 3u},
    {u(ix) " = ADD" w "ao " u(ix) ", " u(bc) "," imp_def(f), 2u},
    {"LD" w "or " u(ix) ", 0, " u(bc), 3u},
    {u(de) " = LD" w "ro " u(ix) ", 0", 3u},
    {u(ix) " = ADD" w "ao " u(ix) ", " u(de) "," imp_def(f), 2u},
    {"LD" w "or " u(ix) ", 0, " u(de), 3u},
    {u(ix) " = LD" w "ri i" w " 0", {4u, 5u}},
    {"LD" w "ma 0, " u(ix) "", {4u, 5u}},
    {u(ix) " = INC" w "r " u(ix) "", 2u},
    {"$ixh = INC8r $ixh," imp_def(f), 2u},
    {"$ixh = DEC8r $ixh," imp_def(f), 2u},
    {"$ixh = LD8ri i8 0", 3u},
    {u(hl) " = LD" w "ro " u(ix) ", 0", 3u},
    {u(ix) " = ADD" w "aa " u(ix) "," imp_def(f), 2u},
    {u(ix) " = LD" w "am 0", {4u, 5u}},
    {u(ix) " = DEC" w "r " u(ix) "", 2u},
    {"$ixl = INC8r $ixl," imp_def(f), 2u},
    {"$ixl = DEC8r $ixl," imp_def(f), 2u},
    {"$ixl = LD8ri i8 0", 3u},
    {"LD" w "or " u(ix) ", 0, " u(hl), 3u},
    {u(iy) " = LD" w "ro " u(ix) ", 0", 3u},
    {"INC8o " u(ix) ", 0," imp_def(f), 3u},
    {"DEC8o " u(ix) ", 0," imp_def(f), 3u},
    {"LD8oi " u(ix) ", 0, 0", 4u},
    {u(ix) " = LD" w "ro " u(ix) ", 0", 3u},
    {u(ix) " = ADD" w "as " u(ix) "," imp_def(sp) l "," imp_def(f) "," imp(sp)
         l,
     2u},
    {"LD" w "or " u(ix) ", 0, " u(iy), 3u},
    {"LD" w "or " u(ix) ", 0, " u(ix), 3u},
    {"$b = LD8xx $ixh", 2u},
    {"$b = LD8xx $ixl", 2u},
    {"$b = LD8go " u(ix) ", 0", 3u},
    {"$c = LD8xx $ixh", 2u},
    {"$c = LD8xx $ixl", 2u},
    {"$c = LD8go " u(ix) ", 0", 3u},
    {"$d = LD8xx $ixh", 2u},
    {"$d = LD8xx $ixl", 2u},
    {"$d = LD8go " u(ix) ", 0", 3u},
    {"$e = LD8xx $ixh", 2u},
    {"$e = LD8xx $ixl", 2u},
    {"$e = LD8go " u(ix) ", 0", 3u},
    {"$ixh = LD8xx $b", 2u},
    {"$ixh = LD8xx $c", 2u},
    {"$ixh = LD8xx $d", 2u},
    {"$ixh = LD8xx $e", 2u},
    {"$ixh = LD8xx $ixh", 2u},
    {"$ixh = LD8xx $ixl", 2u},
    {"$h = LD8go " u(ix) ", 0", 3u},
    {"$ixh = LD8xx $a", 2u},
    {"$ixl = LD8xx $b", 2u},
    {"$ixl = LD8xx $c", 2u},
    {"$ixl = LD8xx $d", 2u},
    {"$ixl = LD8xx $e", 2u},
    {"$ixl = LD8xx $ixh", 2u},
    {"$ixl = LD8xx $ixl", 2u},
    {"$l = LD8go " u(ix) ", 0", 3u},
    {"$ixl = LD8xx $a", 2u},
    {"LD8og " u(ix) ", 0, $b", 3u},
    {"LD8og " u(ix) ", 0, $c", 3u},
    {"LD8og " u(ix) ", 0, $d", 3u},
    {"LD8og " u(ix) ", 0, $e", 3u},
    {"LD8og " u(ix) ", 0, $h", 3u},
    {"LD8og " u(ix) ", 0, $l", 3u},
    {"LD8og " u(ix) ", 0, $a", 3u},
    {"$a = LD8xx $ixh", 2u},
    {"$a = LD8xx $ixl", 2u},
    {"$a = LD8go " u(ix) ", 0", 3u},
    {"ADD8ar $ixh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"ADD8ar $ixl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"ADD8ao " u(ix) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"ADC8ar $ixh," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"ADC8ar $ixl," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"ADC8ao " u(ix) ", 0," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f),
     3u},
    {"SUB8ar $ixh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"SUB8ar $ixl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"SUB8ao " u(ix) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"SBC8ar $ixh," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"SBC8ar $ixl," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"SBC8ao " u(ix) ", 0," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f),
     3u},
    {"AND8ar $ixh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"AND8ar $ixl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"AND8ao " u(ix) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"XOR8ar $ixh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"XOR8ar $ixl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"XOR8ao " u(ix) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"OR8ar $ixh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"OR8ar $ixl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"OR8ao " u(ix) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"CP8ar $ixh," imp_def(f) "," imp(a), 2u},
    {"CP8ar $ixl," imp_def(f) "," imp(a), 2u},
    {"CP8ao " u(ix) ", 0," imp_def(f) "," imp(a), 3u},
    {"$b = RLC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$c = RLC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$d = RLC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$e = RLC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$h = RLC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$l = RLC8go " u(ix) ", 0," imp_def(f), 4u},
    {"RLC8o " u(ix) ", 0," imp_def(f), 4u},
    {"$a = RLC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$b = RRC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$c = RRC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$d = RRC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$e = RRC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$h = RRC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$l = RRC8go " u(ix) ", 0," imp_def(f), 4u},
    {"RRC8o " u(ix) ", 0," imp_def(f), 4u},
    {"$a = RRC8go " u(ix) ", 0," imp_def(f), 4u},
    {"$b = RL8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$c = RL8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$d = RL8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$e = RL8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$h = RL8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$l = RL8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"RL8o " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$a = RL8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$b = RR8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$c = RR8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$d = RR8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$e = RR8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$h = RR8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$l = RR8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"RR8o " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$a = RR8go " u(ix) ", 0," imp_def(f) "," imp(f), 4u},
    {"$b = SLA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$c = SLA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$d = SLA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$e = SLA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$h = SLA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$l = SLA8go " u(ix) ", 0," imp_def(f), 4u},
    {"SLA8o " u(ix) ", 0," imp_def(f), 4u},
    {"$a = SLA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$b = SRA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$c = SRA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$d = SRA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$e = SRA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$h = SRA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$l = SRA8go " u(ix) ", 0," imp_def(f), 4u},
    {"SRA8o " u(ix) ", 0," imp_def(f), 4u},
    {"$a = SRA8go " u(ix) ", 0," imp_def(f), 4u},
    {"$b = SLI8go " u(ix) ", 0," imp_def(f), 4u},
    {"$c = SLI8go " u(ix) ", 0," imp_def(f), 4u},
    {"$d = SLI8go " u(ix) ", 0," imp_def(f), 4u},
    {"$e = SLI8go " u(ix) ", 0," imp_def(f), 4u},
    {"$h = SLI8go " u(ix) ", 0," imp_def(f), 4u},
    {"$l = SLI8go " u(ix) ", 0," imp_def(f), 4u},
    {"SLI8o " u(ix) ", 0," imp_def(f), 4u},
    {"$a = SLI8go " u(ix) ", 0," imp_def(f), 4u},
    {"$b = SRL8go " u(ix) ", 0," imp_def(f), 4u},
    {"$c = SRL8go " u(ix) ", 0," imp_def(f), 4u},
    {"$d = SRL8go " u(ix) ", 0," imp_def(f), 4u},
    {"$e = SRL8go " u(ix) ", 0," imp_def(f), 4u},
    {"$h = SRL8go " u(ix) ", 0," imp_def(f), 4u},
    {"$l = SRL8go " u(ix) ", 0," imp_def(f), 4u},
    {"SRL8o " u(ix) ", 0," imp_def(f), 4u},
    {"$a = SRL8go " u(ix) ", 0," imp_def(f), 4u},
    {"BIT8bo 0, " u(ix) ", 0," imp_def(f), 4u},
    {"BIT8bo 1, " u(ix) ", 0," imp_def(f), 4u},
    {"BIT8bo 2, " u(ix) ", 0," imp_def(f), 4u},
    {"BIT8bo 3, " u(ix) ", 0," imp_def(f), 4u},
    {"BIT8bo 4, " u(ix) ", 0," imp_def(f), 4u},
    {"BIT8bo 5, " u(ix) ", 0," imp_def(f), 4u},
    {"BIT8bo 6, " u(ix) ", 0," imp_def(f), 4u},
    {"BIT8bo 7, " u(ix) ", 0," imp_def(f), 4u},
    {"$b = RES8gbo 0, " u(ix) ", 0", 4u},
    {"$c = RES8gbo 0, " u(ix) ", 0", 4u},
    {"$d = RES8gbo 0, " u(ix) ", 0", 4u},
    {"$e = RES8gbo 0, " u(ix) ", 0", 4u},
    {"$h = RES8gbo 0, " u(ix) ", 0", 4u},
    {"$l = RES8gbo 0, " u(ix) ", 0", 4u},
    {"RES8bo 0, " u(ix) ", 0", 4u},
    {"$a = RES8gbo 0, " u(ix) ", 0", 4u},
    {"$b = RES8gbo 1, " u(ix) ", 0", 4u},
    {"$c = RES8gbo 1, " u(ix) ", 0", 4u},
    {"$d = RES8gbo 1, " u(ix) ", 0", 4u},
    {"$e = RES8gbo 1, " u(ix) ", 0", 4u},
    {"$h = RES8gbo 1, " u(ix) ", 0", 4u},
    {"$l = RES8gbo 1, " u(ix) ", 0", 4u},
    {"RES8bo 1, " u(ix) ", 0", 4u},
    {"$a = RES8gbo 1, " u(ix) ", 0", 4u},
    {"$b = RES8gbo 2, " u(ix) ", 0", 4u},
    {"$c = RES8gbo 2, " u(ix) ", 0", 4u},
    {"$d = RES8gbo 2, " u(ix) ", 0", 4u},
    {"$e = RES8gbo 2, " u(ix) ", 0", 4u},
    {"$h = RES8gbo 2, " u(ix) ", 0", 4u},
    {"$l = RES8gbo 2, " u(ix) ", 0", 4u},
    {"RES8bo 2, " u(ix) ", 0", 4u},
    {"$a = RES8gbo 2, " u(ix) ", 0", 4u},
    {"$b = RES8gbo 3, " u(ix) ", 0", 4u},
    {"$c = RES8gbo 3, " u(ix) ", 0", 4u},
    {"$d = RES8gbo 3, " u(ix) ", 0", 4u},
    {"$e = RES8gbo 3, " u(ix) ", 0", 4u},
    {"$h = RES8gbo 3, " u(ix) ", 0", 4u},
    {"$l = RES8gbo 3, " u(ix) ", 0", 4u},
    {"RES8bo 3, " u(ix) ", 0", 4u},
    {"$a = RES8gbo 3, " u(ix) ", 0", 4u},
    {"$b = RES8gbo 4, " u(ix) ", 0", 4u},
    {"$c = RES8gbo 4, " u(ix) ", 0", 4u},
    {"$d = RES8gbo 4, " u(ix) ", 0", 4u},
    {"$e = RES8gbo 4, " u(ix) ", 0", 4u},
    {"$h = RES8gbo 4, " u(ix) ", 0", 4u},
    {"$l = RES8gbo 4, " u(ix) ", 0", 4u},
    {"RES8bo 4, " u(ix) ", 0", 4u},
    {"$a = RES8gbo 4, " u(ix) ", 0", 4u},
    {"$b = RES8gbo 5, " u(ix) ", 0", 4u},
    {"$c = RES8gbo 5, " u(ix) ", 0", 4u},
    {"$d = RES8gbo 5, " u(ix) ", 0", 4u},
    {"$e = RES8gbo 5, " u(ix) ", 0", 4u},
    {"$h = RES8gbo 5, " u(ix) ", 0", 4u},
    {"$l = RES8gbo 5, " u(ix) ", 0", 4u},
    {"RES8bo 5, " u(ix) ", 0", 4u},
    {"$a = RES8gbo 5, " u(ix) ", 0", 4u},
    {"$b = RES8gbo 6, " u(ix) ", 0", 4u},
    {"$c = RES8gbo 6, " u(ix) ", 0", 4u},
    {"$d = RES8gbo 6, " u(ix) ", 0", 4u},
    {"$e = RES8gbo 6, " u(ix) ", 0", 4u},
    {"$h = RES8gbo 6, " u(ix) ", 0", 4u},
    {"$l = RES8gbo 6, " u(ix) ", 0", 4u},
    {"RES8bo 6, " u(ix) ", 0", 4u},
    {"$a = RES8gbo 6, " u(ix) ", 0", 4u},
    {"$b = RES8gbo 7, " u(ix) ", 0", 4u},
    {"$c = RES8gbo 7, " u(ix) ", 0", 4u},
    {"$d = RES8gbo 7, " u(ix) ", 0", 4u},
    {"$e = RES8gbo 7, " u(ix) ", 0", 4u},
    {"$h = RES8gbo 7, " u(ix) ", 0", 4u},
    {"$l = RES8gbo 7, " u(ix) ", 0", 4u},
    {"RES8bo 7, " u(ix) ", 0", 4u},
    {"$a = RES8gbo 7, " u(ix) ", 0", 4u},
    {"$b = SET8gbo 0, " u(ix) ", 0", 4u},
    {"$c = SET8gbo 0, " u(ix) ", 0", 4u},
    {"$d = SET8gbo 0, " u(ix) ", 0", 4u},
    {"$e = SET8gbo 0, " u(ix) ", 0", 4u},
    {"$h = SET8gbo 0, " u(ix) ", 0", 4u},
    {"$l = SET8gbo 0, " u(ix) ", 0", 4u},
    {"SET8bo 0, " u(ix) ", 0", 4u},
    {"$a = SET8gbo 0, " u(ix) ", 0", 4u},
    {"$b = SET8gbo 1, " u(ix) ", 0", 4u},
    {"$c = SET8gbo 1, " u(ix) ", 0", 4u},
    {"$d = SET8gbo 1, " u(ix) ", 0", 4u},
    {"$e = SET8gbo 1, " u(ix) ", 0", 4u},
    {"$h = SET8gbo 1, " u(ix) ", 0", 4u},
    {"$l = SET8gbo 1, " u(ix) ", 0", 4u},
    {"SET8bo 1, " u(ix) ", 0", 4u},
    {"$a = SET8gbo 1, " u(ix) ", 0", 4u},
    {"$b = SET8gbo 2, " u(ix) ", 0", 4u},
    {"$c = SET8gbo 2, " u(ix) ", 0", 4u},
    {"$d = SET8gbo 2, " u(ix) ", 0", 4u},
    {"$e = SET8gbo 2, " u(ix) ", 0", 4u},
    {"$h = SET8gbo 2, " u(ix) ", 0", 4u},
    {"$l = SET8gbo 2, " u(ix) ", 0", 4u},
    {"SET8bo 2, " u(ix) ", 0", 4u},
    {"$a = SET8gbo 2, " u(ix) ", 0", 4u},
    {"$b = SET8gbo 3, " u(ix) ", 0", 4u},
    {"$c = SET8gbo 3, " u(ix) ", 0", 4u},
    {"$d = SET8gbo 3, " u(ix) ", 0", 4u},
    {"$e = SET8gbo 3, " u(ix) ", 0", 4u},
    {"$h = SET8gbo 3, " u(ix) ", 0", 4u},
    {"$l = SET8gbo 3, " u(ix) ", 0", 4u},
    {"SET8bo 3, " u(ix) ", 0", 4u},
    {"$a = SET8gbo 3, " u(ix) ", 0", 4u},
    {"$b = SET8gbo 4, " u(ix) ", 0", 4u},
    {"$c = SET8gbo 4, " u(ix) ", 0", 4u},
    {"$d = SET8gbo 4, " u(ix) ", 0", 4u},
    {"$e = SET8gbo 4, " u(ix) ", 0", 4u},
    {"$h = SET8gbo 4, " u(ix) ", 0", 4u},
    {"$l = SET8gbo 4, " u(ix) ", 0", 4u},
    {"SET8bo 4, " u(ix) ", 0", 4u},
    {"$a = SET8gbo 4, " u(ix) ", 0", 4u},
    {"$b = SET8gbo 5, " u(ix) ", 0", 4u},
    {"$c = SET8gbo 5, " u(ix) ", 0", 4u},
    {"$d = SET8gbo 5, " u(ix) ", 0", 4u},
    {"$e = SET8gbo 5, " u(ix) ", 0", 4u},
    {"$h = SET8gbo 5, " u(ix) ", 0", 4u},
    {"$l = SET8gbo 5, " u(ix) ", 0", 4u},
    {"SET8bo 5, " u(ix) ", 0", 4u},
    {"$a = SET8gbo 5, " u(ix) ", 0", 4u},
    {"$b = SET8gbo 6, " u(ix) ", 0", 4u},
    {"$c = SET8gbo 6, " u(ix) ", 0", 4u},
    {"$d = SET8gbo 6, " u(ix) ", 0", 4u},
    {"$e = SET8gbo 6, " u(ix) ", 0", 4u},
    {"$h = SET8gbo 6, " u(ix) ", 0", 4u},
    {"$l = SET8gbo 6, " u(ix) ", 0", 4u},
    {"SET8bo 6, " u(ix) ", 0", 4u},
    {"$a = SET8gbo 6, " u(ix) ", 0", 4u},
    {"$b = SET8gbo 7, " u(ix) ", 0", 4u},
    {"$c = SET8gbo 7, " u(ix) ", 0", 4u},
    {"$d = SET8gbo 7, " u(ix) ", 0", 4u},
    {"$e = SET8gbo 7, " u(ix) ", 0", 4u},
    {"$h = SET8gbo 7, " u(ix) ", 0", 4u},
    {"$l = SET8gbo 7, " u(ix) ", 0", 4u},
    {"SET8bo 7, " u(ix) ", 0", 4u},
    {"$a = SET8gbo 7, " u(ix) ", 0", 4u},
    {u(ix) " = POP" w "r" imp_def(sp) l "," imp(sp) l, 2u},
    {u(ix) " = EX" w "sa " u(ix) "," imp(sp) l, 2u},
    {"PUSH" w "r " u(ix) "," imp_def(sp) l "," imp(sp) l, 2u},
    {"JP" w "r " u(ix) def_bb, 2u},
    {"LD" w "sa " u(ix) "," imp_def(sp) l, 2u},
    {"SBC8ai 0," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"RST" w " 24," imp_def(sp) l "," imp(sp) l, 1u},
    {"RET" w "CC" po "," imp_def(sp) l "," imp(f) "," imp(sp) l def_bb, 1u},
    {u(hl) " = POP" w "r" imp_def(sp) l "," imp(sp) l, 1u},
    {"JP" w "CC" bb "," po "," imp(f) def_bb, {3u, 4u}},
    {u(hl) " = EX" w "sa " u(hl) "," imp(sp) l, 1u},
    {"CALL" w "CC 0," po "," csr "," imp(f) "," imp(sp) l, {3u, 4u}},
    {"PUSH" w "r " u(hl) "," imp_def(sp) l "," imp(sp) l, 1u},
    {"AND8ai 0," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"RST" w " 32," imp_def(sp) l "," imp(sp) l, 1u},
    {"RET" w "CC" pe "," imp_def(sp) l "," imp(f) "," imp(sp) l def_bb, 1u},
    {"JP" w "r " u(hl) def_bb, 1u},
    {"JP" w "CC" bb "," pe "," imp(f) def_bb, {3u, 4u}},
    {"EX" w "DE" imp_def_u(de) "," imp_def_u(hl) "," imp_u(de) "," imp_u(hl),
     1u},
    {"CALL" w "CC 0," pe "," csr "," imp(f) "," imp(sp) l, {3u, 4u}},
    {"$b = IN8gm 0," imp_def(f), 3u},
    {"OUT8mg 0, $b", 3u},
    {u(bc) " = LEA" w "ro " u(ix) ", 0", 3u},
    {u(bc) " = LEA" w "ro " u(iy) ", 0", 3u},
    {"TST8ar $b," imp_def(f) "," imp(a), 2u},
    {u(bc) " = LD" w "rp " u(hl), 2u},
    {"$c = IN8gm 0," imp_def(f), 3u},
    {"OUT8mg 0, $c", 3u},
    {"TST8ar $c," imp_def(f) "," imp(a), 2u},
    {"LD" w "pr " u(hl) ", " u(bc), 2u},
    {"$d = IN8gm 0," imp_def(f), 3u},
    {"OUT8mg 0, $d", 3u},
    {u(de) " = LEA" w "ro " u(ix) ", 0", 3u},
    {u(de) " = LEA" w "ro " u(iy) ", 0", 3u},
    {"TST8ar $d," imp_def(f) "," imp(a), 2u},
    {u(de) " = LD" w "rp " u(hl), 2u},
    {"$e = IN8gm 0," imp_def(f), 3u},
    {"OUT8mg 0, $e", 3u},
    {"TST8ar $e," imp_def(f) "," imp(a), 2u},
    {"LD" w "pr " u(hl) ", " u(de), 2u},
    {"$h = IN8gm 0," imp_def(f), 3u},
    {"OUT8mg 0, $h", 3u},
    {u(hl) " = LEA" w "ro " u(ix) ", 0", 3u},
    {u(hl) " = LEA" w "ro " u(iy) ", 0", 3u},
    {"TST8ar $h," imp_def(f) "," imp(a), 2u},
    {u(hl) " = LD" w "rp " u(hl), 2u},
    {"$l = IN8gm 0," imp_def(f), 3u},
    {"OUT8mg 0, $l", 3u},
    {"TST8ar $l," imp_def(f) "," imp(a), 2u},
    {"LD" w "pr " u(hl) ", " u(hl), 2u},
    {u(iy) " = LD" w "rp " u(hl), 2u},
    {u(ix) " = LEA" w "ro " u(ix) ", 0", 3u},
    {u(iy) " = LEA" w "ro " u(iy) ", 0", 3u},
    {"TST8ap " u(hl) "," imp_def(f) "," imp(a), 2u},
    {u(ix) " = LD" w "rp " u(hl), 2u},
    {"$a = IN8gm 0," imp_def(f), 3u},
    {"OUT8mg 0, $a", 3u},
    {"TST8ar $a," imp_def(f) "," imp(a), 2u},
    {"LD" w "pr " u(hl) ", " u(iy), 2u},
    {"LD" w "pr " u(hl) ", " u(ix), 2u},
    {"$b = IN8gp" imp_def(f) "," imp(bc), 2u},
    {"OUT8pg $b," imp(bc), 2u},
    {"SBC" w
     "ao " u(bc) "," imp_def_u(hl) "," imp_def(f) "," imp_u(hl) "," imp(f),
     2u},
    {"LD" w "mg 0, " u(bc), {4u, 5u}},
    {"NEG" imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"RETN" w imp_def(sp) l "," imp(sp) l def_bb, 2u},
    {"IM 0", 2u},
    {"LD8ia" imp_def(i) "," imp(a), 2u},
    {"$c = IN8gp" imp_def(f) "," imp(bc), 2u},
    {"OUT8pg $c," imp(bc), 2u},
    {"ADC" w
     "ao " u(bc) "," imp_def_u(hl) "," imp_def(f) "," imp_u(hl) "," imp(f),
     2u},
    {u(bc) " = LD" w "gm 0", {4u, 5u}},
    {"$bc = MLT16r $bc", 2u},
    {"RETI" w imp_def(sp) l "," imp(sp) l def_bb, 2u},
    {"LD8ra" imp_def(r) "," imp(a), 2u},
    {"$d = IN8gp" imp_def(f) "," imp(bc), 2u},
    {"OUT8pg $d," imp(bc), 2u},
    {"SBC" w
     "ao " u(de) "," imp_def_u(hl) "," imp_def(f) "," imp_u(hl) "," imp(f),
     2u},
    {"LD" w "mg 0, " u(de), {4u, 5u}},
    {u(ix) " = LEA" w "ro " u(iy) ", 0", 3u},
    {u(iy) " = LEA" w "ro " u(ix) ", 0", 3u},
    {"IM 1", 2u},
    {"LD8ai" imp_def(a) "," imp_def(f) "," imp(i), 2u},
    {"$e = IN8gp" imp_def(f) "," imp(bc), 2u},
    {"OUT8pg $e," imp(bc), 2u},
    {"ADC" w
     "ao " u(de) "," imp_def_u(hl) "," imp_def(f) "," imp_u(hl) "," imp(f),
     2u},
    {u(de) " = LD" w "gm 0", {4u, 5u}},
    {"$de = MLT16r $de", 2u},
    {"IM 2", 2u},
    {"LD8ar" imp_def(a) "," imp_def(f) "," imp(r), 2u},
    {"$h = IN8gp" imp_def(f) "," imp(bc), 2u},
    {"OUT8pg $h," imp(bc), 2u},
    {"SBC" w "aa" imp_def_u(hl) "," imp_def(f) "," imp_u(hl) "," imp(f), 2u},
    {"LD" w "mg 0, " u(hl), {4u, 5u}},
    {"TST8ai 0," imp_def(f) "," imp(a), 3u},
    {"PEA" w "o " u(ix) ", 0," imp_def(sp) l "," imp(sp) l, 3u},
    {"PEA" w "o " u(iy) ", 0," imp_def(sp) l "," imp(sp) l, 3u},
    {"RRD" w imp_def(a) "," imp_def(f) "," imp_u(hl) "," imp(a), 2u},
    {"$l = IN8gp" imp_def(f) "," imp(bc), 2u},
    {"OUT8pg $l," imp(bc), 2u},
    {"ADC" w "aa" imp_def_u(hl) "," imp_def(f) "," imp_u(hl) "," imp(f), 2u},
    {u(hl) " = LD" w "gm 0", {4u, 5u}},
    {"$hl = MLT16r $hl", 2u},
    {"LD8mba" imp_def(mb) "," imp(a), 2u},
    {"LD8amb" imp_def(a) "," imp(mb), 2u},
    {"RLD" w imp_def(a) "," imp_def(f) "," imp_u(hl) "," imp(a), 2u},
    {"SBC" w "as" imp_def_u(hl) "," imp_def(f) "," imp_u(hl) "," imp(sp) l
     "," imp(f),
     2u},
    {"LD" w "ms 0," imp(sp) l, {4u, 5u}},
    {"TST8mi 0," imp_def(f) "," imp(c), 3u},
    {"SLP", 2u},
    {"$a = IN8gp" imp_def(f) "," imp(bc), 2u},
    {"OUT8pg $a," imp(bc), 2u},
    {"ADC" w "as" imp_def_u(hl) "," imp_def(f) "," imp_u(hl) "," imp(sp) l
     "," imp(f),
     2u},
    {"LD" w "sm 0," imp_def(sp) l, {4u, 5u}},
    {"MLT" w "s" imp_def(sp) l "," imp(sp) l, 2u},
    {"STMIX", 2u},
    {"RSMIX", 2u},
    {"INMI" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"OTMI" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"IN2I" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"INMD" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"OTMD" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"IN2D" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"INMIR" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"OTMIR" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"IN2IR" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"INMDR" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"OTMDR" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"IN2DR" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"LDI" w imp_def_u(hl) "," imp_def_u(de) "," imp_def_u(bc) "," imp_def(
         f) "," imp_u(hl) "," imp_u(de) "," imp_u(bc),
     2u},
    {"CPI" w imp_def_u(hl) "," imp_def_u(bc) "," imp_def(f) "," imp_u(
         hl) "," imp_u(bc) "," imp(a),
     2u},
    {"INI" w imp_def_u(hl) "," imp_def(bc) "," imp_def(f) "," imp_u(hl) "," imp(
         bc),
     2u},
    {"OUTI" w imp_def_u(hl) "," imp_def(bc) "," imp_def(f) "," imp_u(
         hl) "," imp(bc),
     2u},
    {"OUT2I" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"LDD" w imp_def_u(hl) "," imp_def_u(de) "," imp_def_u(bc) "," imp_def(
         f) "," imp_u(hl) "," imp_u(de) "," imp_u(bc),
     2u},
    {"CPD" w imp_def_u(hl) "," imp_def_u(bc) "," imp_def(f) "," imp_u(
         hl) "," imp_u(bc) "," imp(a),
     2u},
    {"IND" w imp_def_u(hl) "," imp_def(bc) "," imp_def(f) "," imp_u(hl) "," imp(
         bc),
     2u},
    {"OUTD" w imp_def_u(hl) "," imp_def(bc) "," imp_def(f) "," imp_u(
         hl) "," imp(bc),
     2u},
    {"OUT2D" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"LDIR" w imp_def_u(hl) "," imp_def_u(de) "," imp_def_u(bc) "," imp_def(
         f) "," imp_u(hl) "," imp_u(de) "," imp_u(bc),
     2u},
    {"CPIR" w imp_def_u(hl) "," imp_def_u(bc) "," imp_def(f) "," imp_u(
         hl) "," imp_u(bc) "," imp(a),
     2u},
    {"INIR" w imp_def_u(hl) "," imp_def(bc) "," imp_def(f) "," imp_u(
         hl) "," imp(bc),
     2u},
    {"OUTIR" w imp_def_u(hl) "," imp_def(bc) "," imp_def(f) "," imp_u(
         hl) "," imp(bc),
     2u},
    {"OUT2IR" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"LDDR" w imp_def_u(hl) "," imp_def_u(de) "," imp_def_u(bc) "," imp_def(
         f) "," imp_u(hl) "," imp_u(de) "," imp_u(bc),
     2u},
    {"CPDR" w imp_def_u(hl) "," imp_def_u(bc) "," imp_def(f) "," imp_u(
         hl) "," imp_u(bc) "," imp(a),
     2u},
    {"INDR" w imp_def_u(hl) "," imp_def(bc) "," imp_def(f) "," imp_u(
         hl) "," imp(bc),
     2u},
    {"OUTDR" w imp_def_u(hl) "," imp_def(bc) "," imp_def(f) "," imp_u(
         hl) "," imp(bc),
     2u},
    {"OUT2DR" w imp_def_u(hl) "," imp_def(c) "," imp_def(b) "," imp_def(
         f) "," imp_u(hl) "," imp(c) "," imp(b),
     2u},
    {"INIRX" w imp_def_u(hl) "," imp_def_u(de) "," imp_def_u(bc) "," imp_def(
         f) "," imp_u(hl) "," imp_u(de) "," imp_u(bc),
     2u},
    {"OTIRX" w imp_def_u(hl) "," imp_def_u(de) "," imp_def_u(bc) "," imp_def(
         f) "," imp_u(hl) "," imp_u(de) "," imp_u(bc),
     2u},
    {"LD16ia" imp_def(i) "," imp(hl), 2u},
    {"INDRX" w imp_def_u(hl) "," imp_def_u(de) "," imp_def_u(bc) "," imp_def(
         f) "," imp_u(hl) "," imp_u(de) "," imp_u(bc),
     2u},
    {"OTDRX" w imp_def_u(hl) "," imp_def_u(de) "," imp_def_u(bc) "," imp_def(
         f) "," imp_u(hl) "," imp_u(de) "," imp_u(bc),
     2u},
    {"LD" w "ai" imp_def_u(hl) "," imp(i) "," imp(mb), 2u},
    {"XOR8ai 0," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"RST" w " 40," imp_def(sp) l "," imp(sp) l, 1u},
    {"RET" w "CC" p "," imp_def(sp) l "," imp(f) "," imp(sp) l def_bb, 1u},
    {"POP" w "AF" imp_def(af) "," imp_def(sp) l "," imp(sp) l, 1u},
    {"JP" w "CC" bb "," p "," imp(f) def_bb, {3u, 4u}},
    {"DI", 1u},
    {"CALL" w "CC 0," p "," csr "," imp(f) "," imp(sp) l, {3u, 4u}},
    {"PUSH" w "AF" imp_def(sp) l "," imp(af) "," imp(sp) l, 1u},
    {"OR8ai 0," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"RST" w " 48," imp_def(sp) l "," imp(sp) l, 1u},
    {"RET" w "CC" m "," imp_def(sp) l "," imp(f) "," imp(sp) l def_bb, 1u},
    {"LD" w "sa " u(hl) "," imp_def(sp) l, 1u},
    {"JP" w "CC" bb "," m "," imp(f) def_bb, {3u, 4u}},
    {"EI", 1u},
    {"CALL" w "CC 0," m "," csr "," imp(f) "," imp(sp) l, {3u, 4u}},
    {u(bc) " = LD" w "ro " u(iy) ", 0", 3u},
    {u(iy) " = ADD" w "ao " u(iy) ", " u(bc) "," imp_def(f), 2u},
    {"LD" w "or " u(iy) ", 0, " u(bc), 3u},
    {u(de) " = LD" w "ro " u(iy) ", 0", 3u},
    {u(iy) " = ADD" w "ao " u(iy) ", " u(de) "," imp_def(f), 2u},
    {"LD" w "or " u(iy) ", 0, " u(de), 3u},
    {u(iy) " = LD" w "ri i" w " 0", {4u, 5u}},
    {"LD" w "ma 0, " u(iy) "", {4u, 5u}},
    {u(iy) " = INC" w "r " u(iy) "", 2u},
    {"$iyh = INC8r $iyh," imp_def(f), 2u},
    {"$iyh = DEC8r $iyh," imp_def(f), 2u},
    {"$iyh = LD8ri i8 0", 3u},
    {u(hl) " = LD" w "ro " u(iy) ", 0", 3u},
    {u(iy) " = ADD" w "aa " u(iy) "," imp_def(f), 2u},
    {u(iy) " = LD" w "am 0", {4u, 5u}},
    {u(iy) " = DEC" w "r " u(iy) "", 2u},
    {"$iyl = INC8r $iyl," imp_def(f), 2u},
    {"$iyl = DEC8r $iyl," imp_def(f), 2u},
    {"$iyl = LD8ri i8 0", 3u},
    {"LD" w "or " u(iy) ", 0, " u(hl), 3u},
    {u(ix) " = LD" w "ro " u(iy) ", 0", 3u},
    {"INC8o " u(iy) ", 0," imp_def(f), 3u},
    {"DEC8o " u(iy) ", 0," imp_def(f), 3u},
    {"LD8oi " u(iy) ", 0, 0", 4u},
    {u(iy) " = LD" w "ro " u(iy) ", 0", 3u},
    {u(iy) " = ADD" w "as " u(iy) "," imp_def(sp) l "," imp_def(f) "," imp(sp)
         l,
     2u},
    {"LD" w "or " u(iy) ", 0, " u(ix), 3u},
    {"LD" w "or " u(iy) ", 0, " u(iy), 3u},
    {"$b = LD8yy $iyh", 2u},
    {"$b = LD8yy $iyl", 2u},
    {"$b = LD8go " u(iy) ", 0", 3u},
    {"$c = LD8yy $iyh", 2u},
    {"$c = LD8yy $iyl", 2u},
    {"$c = LD8go " u(iy) ", 0", 3u},
    {"$d = LD8yy $iyh", 2u},
    {"$d = LD8yy $iyl", 2u},
    {"$d = LD8go " u(iy) ", 0", 3u},
    {"$e = LD8yy $iyh", 2u},
    {"$e = LD8yy $iyl", 2u},
    {"$e = LD8go " u(iy) ", 0", 3u},
    {"$iyh = LD8yy $b", 2u},
    {"$iyh = LD8yy $c", 2u},
    {"$iyh = LD8yy $d", 2u},
    {"$iyh = LD8yy $e", 2u},
    {"$iyh = LD8yy $iyh", 2u},
    {"$iyh = LD8yy $iyl", 2u},
    {"$h = LD8go " u(iy) ", 0", 3u},
    {"$iyh = LD8yy $a", 2u},
    {"$iyl = LD8yy $b", 2u},
    {"$iyl = LD8yy $c", 2u},
    {"$iyl = LD8yy $d", 2u},
    {"$iyl = LD8yy $e", 2u},
    {"$iyl = LD8yy $iyh", 2u},
    {"$iyl = LD8yy $iyl", 2u},
    {"$l = LD8go " u(iy) ", 0", 3u},
    {"$iyl = LD8yy $a", 2u},
    {"LD8og " u(iy) ", 0, $b", 3u},
    {"LD8og " u(iy) ", 0, $c", 3u},
    {"LD8og " u(iy) ", 0, $d", 3u},
    {"LD8og " u(iy) ", 0, $e", 3u},
    {"LD8og " u(iy) ", 0, $h", 3u},
    {"LD8og " u(iy) ", 0, $l", 3u},
    {"LD8og " u(iy) ", 0, $a", 3u},
    {"$a = LD8yy $iyh", 2u},
    {"$a = LD8yy $iyl", 2u},
    {"$a = LD8go " u(iy) ", 0", 3u},
    {"ADD8ar $iyh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"ADD8ar $iyl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"ADD8ao " u(iy) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"ADC8ar $iyh," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"ADC8ar $iyl," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"ADC8ao " u(iy) ", 0," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f),
     3u},
    {"SUB8ar $iyh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"SUB8ar $iyl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"SUB8ao " u(iy) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"SBC8ar $iyh," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"SBC8ar $iyl," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f), 2u},
    {"SBC8ao " u(iy) ", 0," imp_def(a) "," imp_def(f) "," imp(a) "," imp(f),
     3u},
    {"AND8ar $iyh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"AND8ar $iyl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"AND8ao " u(iy) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"XOR8ar $iyh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"XOR8ar $iyl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"XOR8ao " u(iy) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"OR8ar $iyh," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"OR8ar $iyl," imp_def(a) "," imp_def(f) "," imp(a), 2u},
    {"OR8ao " u(iy) ", 0," imp_def(a) "," imp_def(f) "," imp(a), 3u},
    {"CP8ar $iyh," imp_def(f) "," imp(a), 2u},
    {"CP8ar $iyl," imp_def(f) "," imp(a), 2u},
    {"CP8ao " u(iy) ", 0," imp_def(f) "," imp(a), 3u},
    {"$b = RLC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$c = RLC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$d = RLC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$e = RLC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$h = RLC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$l = RLC8go " u(iy) ", 0," imp_def(f), 4u},
    {"RLC8o " u(iy) ", 0," imp_def(f), 4u},
    {"$a = RLC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$b = RRC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$c = RRC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$d = RRC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$e = RRC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$h = RRC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$l = RRC8go " u(iy) ", 0," imp_def(f), 4u},
    {"RRC8o " u(iy) ", 0," imp_def(f), 4u},
    {"$a = RRC8go " u(iy) ", 0," imp_def(f), 4u},
    {"$b = RL8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$c = RL8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$d = RL8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$e = RL8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$h = RL8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$l = RL8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"RL8o " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$a = RL8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$b = RR8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$c = RR8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$d = RR8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$e = RR8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$h = RR8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$l = RR8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"RR8o " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$a = RR8go " u(iy) ", 0," imp_def(f) "," imp(f), 4u},
    {"$b = SLA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$c = SLA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$d = SLA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$e = SLA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$h = SLA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$l = SLA8go " u(iy) ", 0," imp_def(f), 4u},
    {"SLA8o " u(iy) ", 0," imp_def(f), 4u},
    {"$a = SLA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$b = SRA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$c = SRA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$d = SRA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$e = SRA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$h = SRA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$l = SRA8go " u(iy) ", 0," imp_def(f), 4u},
    {"SRA8o " u(iy) ", 0," imp_def(f), 4u},
    {"$a = SRA8go " u(iy) ", 0," imp_def(f), 4u},
    {"$b = SLI8go " u(iy) ", 0," imp_def(f), 4u},
    {"$c = SLI8go " u(iy) ", 0," imp_def(f), 4u},
    {"$d = SLI8go " u(iy) ", 0," imp_def(f), 4u},
    {"$e = SLI8go " u(iy) ", 0," imp_def(f), 4u},
    {"$h = SLI8go " u(iy) ", 0," imp_def(f), 4u},
    {"$l = SLI8go " u(iy) ", 0," imp_def(f), 4u},
    {"SLI8o " u(iy) ", 0," imp_def(f), 4u},
    {"$a = SLI8go " u(iy) ", 0," imp_def(f), 4u},
    {"$b = SRL8go " u(iy) ", 0," imp_def(f), 4u},
    {"$c = SRL8go " u(iy) ", 0," imp_def(f), 4u},
    {"$d = SRL8go " u(iy) ", 0," imp_def(f), 4u},
    {"$e = SRL8go " u(iy) ", 0," imp_def(f), 4u},
    {"$h = SRL8go " u(iy) ", 0," imp_def(f), 4u},
    {"$l = SRL8go " u(iy) ", 0," imp_def(f), 4u},
    {"SRL8o " u(iy) ", 0," imp_def(f), 4u},
    {"$a = SRL8go " u(iy) ", 0," imp_def(f), 4u},
    {"BIT8bo 0, " u(iy) ", 0," imp_def(f), 4u},
    {"BIT8bo 1, " u(iy) ", 0," imp_def(f), 4u},
    {"BIT8bo 2, " u(iy) ", 0," imp_def(f), 4u},
    {"BIT8bo 3, " u(iy) ", 0," imp_def(f), 4u},
    {"BIT8bo 4, " u(iy) ", 0," imp_def(f), 4u},
    {"BIT8bo 5, " u(iy) ", 0," imp_def(f), 4u},
    {"BIT8bo 6, " u(iy) ", 0," imp_def(f), 4u},
    {"BIT8bo 7, " u(iy) ", 0," imp_def(f), 4u},
    {"$b = RES8gbo 0, " u(iy) ", 0", 4u},
    {"$c = RES8gbo 0, " u(iy) ", 0", 4u},
    {"$d = RES8gbo 0, " u(iy) ", 0", 4u},
    {"$e = RES8gbo 0, " u(iy) ", 0", 4u},
    {"$h = RES8gbo 0, " u(iy) ", 0", 4u},
    {"$l = RES8gbo 0, " u(iy) ", 0", 4u},
    {"RES8bo 0, " u(iy) ", 0", 4u},
    {"$a = RES8gbo 0, " u(iy) ", 0", 4u},
    {"$b = RES8gbo 1, " u(iy) ", 0", 4u},
    {"$c = RES8gbo 1, " u(iy) ", 0", 4u},
    {"$d = RES8gbo 1, " u(iy) ", 0", 4u},
    {"$e = RES8gbo 1, " u(iy) ", 0", 4u},
    {"$h = RES8gbo 1, " u(iy) ", 0", 4u},
    {"$l = RES8gbo 1, " u(iy) ", 0", 4u},
    {"RES8bo 1, " u(iy) ", 0", 4u},
    {"$a = RES8gbo 1, " u(iy) ", 0", 4u},
    {"$b = RES8gbo 2, " u(iy) ", 0", 4u},
    {"$c = RES8gbo 2, " u(iy) ", 0", 4u},
    {"$d = RES8gbo 2, " u(iy) ", 0", 4u},
    {"$e = RES8gbo 2, " u(iy) ", 0", 4u},
    {"$h = RES8gbo 2, " u(iy) ", 0", 4u},
    {"$l = RES8gbo 2, " u(iy) ", 0", 4u},
    {"RES8bo 2, " u(iy) ", 0", 4u},
    {"$a = RES8gbo 2, " u(iy) ", 0", 4u},
    {"$b = RES8gbo 3, " u(iy) ", 0", 4u},
    {"$c = RES8gbo 3, " u(iy) ", 0", 4u},
    {"$d = RES8gbo 3, " u(iy) ", 0", 4u},
    {"$e = RES8gbo 3, " u(iy) ", 0", 4u},
    {"$h = RES8gbo 3, " u(iy) ", 0", 4u},
    {"$l = RES8gbo 3, " u(iy) ", 0", 4u},
    {"RES8bo 3, " u(iy) ", 0", 4u},
    {"$a = RES8gbo 3, " u(iy) ", 0", 4u},
    {"$b = RES8gbo 4, " u(iy) ", 0", 4u},
    {"$c = RES8gbo 4, " u(iy) ", 0", 4u},
    {"$d = RES8gbo 4, " u(iy) ", 0", 4u},
    {"$e = RES8gbo 4, " u(iy) ", 0", 4u},
    {"$h = RES8gbo 4, " u(iy) ", 0", 4u},
    {"$l = RES8gbo 4, " u(iy) ", 0", 4u},
    {"RES8bo 4, " u(iy) ", 0", 4u},
    {"$a = RES8gbo 4, " u(iy) ", 0", 4u},
    {"$b = RES8gbo 5, " u(iy) ", 0", 4u},
    {"$c = RES8gbo 5, " u(iy) ", 0", 4u},
    {"$d = RES8gbo 5, " u(iy) ", 0", 4u},
    {"$e = RES8gbo 5, " u(iy) ", 0", 4u},
    {"$h = RES8gbo 5, " u(iy) ", 0", 4u},
    {"$l = RES8gbo 5, " u(iy) ", 0", 4u},
    {"RES8bo 5, " u(iy) ", 0", 4u},
    {"$a = RES8gbo 5, " u(iy) ", 0", 4u},
    {"$b = RES8gbo 6, " u(iy) ", 0", 4u},
    {"$c = RES8gbo 6, " u(iy) ", 0", 4u},
    {"$d = RES8gbo 6, " u(iy) ", 0", 4u},
    {"$e = RES8gbo 6, " u(iy) ", 0", 4u},
    {"$h = RES8gbo 6, " u(iy) ", 0", 4u},
    {"$l = RES8gbo 6, " u(iy) ", 0", 4u},
    {"RES8bo 6, " u(iy) ", 0", 4u},
    {"$a = RES8gbo 6, " u(iy) ", 0", 4u},
    {"$b = RES8gbo 7, " u(iy) ", 0", 4u},
    {"$c = RES8gbo 7, " u(iy) ", 0", 4u},
    {"$d = RES8gbo 7, " u(iy) ", 0", 4u},
    {"$e = RES8gbo 7, " u(iy) ", 0", 4u},
    {"$h = RES8gbo 7, " u(iy) ", 0", 4u},
    {"$l = RES8gbo 7, " u(iy) ", 0", 4u},
    {"RES8bo 7, " u(iy) ", 0", 4u},
    {"$a = RES8gbo 7, " u(iy) ", 0", 4u},
    {"$b = SET8gbo 0, " u(iy) ", 0", 4u},
    {"$c = SET8gbo 0, " u(iy) ", 0", 4u},
    {"$d = SET8gbo 0, " u(iy) ", 0", 4u},
    {"$e = SET8gbo 0, " u(iy) ", 0", 4u},
    {"$h = SET8gbo 0, " u(iy) ", 0", 4u},
    {"$l = SET8gbo 0, " u(iy) ", 0", 4u},
    {"SET8bo 0, " u(iy) ", 0", 4u},
    {"$a = SET8gbo 0, " u(iy) ", 0", 4u},
    {"$b = SET8gbo 1, " u(iy) ", 0", 4u},
    {"$c = SET8gbo 1, " u(iy) ", 0", 4u},
    {"$d = SET8gbo 1, " u(iy) ", 0", 4u},
    {"$e = SET8gbo 1, " u(iy) ", 0", 4u},
    {"$h = SET8gbo 1, " u(iy) ", 0", 4u},
    {"$l = SET8gbo 1, " u(iy) ", 0", 4u},
    {"SET8bo 1, " u(iy) ", 0", 4u},
    {"$a = SET8gbo 1, " u(iy) ", 0", 4u},
    {"$b = SET8gbo 2, " u(iy) ", 0", 4u},
    {"$c = SET8gbo 2, " u(iy) ", 0", 4u},
    {"$d = SET8gbo 2, " u(iy) ", 0", 4u},
    {"$e = SET8gbo 2, " u(iy) ", 0", 4u},
    {"$h = SET8gbo 2, " u(iy) ", 0", 4u},
    {"$l = SET8gbo 2, " u(iy) ", 0", 4u},
    {"SET8bo 2, " u(iy) ", 0", 4u},
    {"$a = SET8gbo 2, " u(iy) ", 0", 4u},
    {"$b = SET8gbo 3, " u(iy) ", 0", 4u},
    {"$c = SET8gbo 3, " u(iy) ", 0", 4u},
    {"$d = SET8gbo 3, " u(iy) ", 0", 4u},
    {"$e = SET8gbo 3, " u(iy) ", 0", 4u},
    {"$h = SET8gbo 3, " u(iy) ", 0", 4u},
    {"$l = SET8gbo 3, " u(iy) ", 0", 4u},
    {"SET8bo 3, " u(iy) ", 0", 4u},
    {"$a = SET8gbo 3, " u(iy) ", 0", 4u},
    {"$b = SET8gbo 4, " u(iy) ", 0", 4u},
    {"$c = SET8gbo 4, " u(iy) ", 0", 4u},
    {"$d = SET8gbo 4, " u(iy) ", 0", 4u},
    {"$e = SET8gbo 4, " u(iy) ", 0", 4u},
    {"$h = SET8gbo 4, " u(iy) ", 0", 4u},
    {"$l = SET8gbo 4, " u(iy) ", 0", 4u},
    {"SET8bo 4, " u(iy) ", 0", 4u},
    {"$a = SET8gbo 4, " u(iy) ", 0", 4u},
    {"$b = SET8gbo 5, " u(iy) ", 0", 4u},
    {"$c = SET8gbo 5, " u(iy) ", 0", 4u},
    {"$d = SET8gbo 5, " u(iy) ", 0", 4u},
    {"$e = SET8gbo 5, " u(iy) ", 0", 4u},
    {"$h = SET8gbo 5, " u(iy) ", 0", 4u},
    {"$l = SET8gbo 5, " u(iy) ", 0", 4u},
    {"SET8bo 5, " u(iy) ", 0", 4u},
    {"$a = SET8gbo 5, " u(iy) ", 0", 4u},
    {"$b = SET8gbo 6, " u(iy) ", 0", 4u},
    {"$c = SET8gbo 6, " u(iy) ", 0", 4u},
    {"$d = SET8gbo 6, " u(iy) ", 0", 4u},
    {"$e = SET8gbo 6, " u(iy) ", 0", 4u},
    {"$h = SET8gbo 6, " u(iy) ", 0", 4u},
    {"$l = SET8gbo 6, " u(iy) ", 0", 4u},
    {"SET8bo 6, " u(iy) ", 0", 4u},
    {"$a = SET8gbo 6, " u(iy) ", 0", 4u},
    {"$b = SET8gbo 7, " u(iy) ", 0", 4u},
    {"$c = SET8gbo 7, " u(iy) ", 0", 4u},
    {"$d = SET8gbo 7, " u(iy) ", 0", 4u},
    {"$e = SET8gbo 7, " u(iy) ", 0", 4u},
    {"$h = SET8gbo 7, " u(iy) ", 0", 4u},
    {"$l = SET8gbo 7, " u(iy) ", 0", 4u},
    {"SET8bo 7, " u(iy) ", 0", 4u},
    {"$a = SET8gbo 7, " u(iy) ", 0", 4u},
    {u(iy) " = POP" w "r" imp_def(sp) l "," imp(sp) l, 2u},
    {u(iy) " = EX" w "sa " u(iy) "," imp(sp) l, 2u},
    {"PUSH" w "r " u(iy) "," imp_def(sp) l "," imp(sp) l, 2u},
    {"JP" w "r " u(iy) def_bb, 2u},
    {"LD" w "sa " u(iy) "," imp_def(sp) l, 2u},
    {"CP8ai 0," imp_def(f) "," imp(a), 2u},
    {"RST" w " 56," imp_def(sp) l "," imp(sp) l, 1u},
#undef imp_u
#undef imp
#undef imp_def_u
#undef imp_def
#undef m
#undef p
#undef pe
#undef po
#undef c
#undef nc
#undef z
#undef nz
#undef bb
#undef csr
#undef u
#undef l
#undef w
};

void checkInstructionSizes(StringRef T) {
  std::string TT(Triple::normalize(T));

  LLVMInitializeZ80TargetInfo();
  LLVMInitializeZ80Target();
  LLVMInitializeZ80TargetMC();

  std::string Error;
  auto *TheTarget = TargetRegistry::lookupTarget(TT, Error);
  ASSERT_TRUE(TheTarget);

  std::unique_ptr<Z80TargetMachine> TM(static_cast<Z80TargetMachine *>(
      TheTarget->createTargetMachine(TT, "generic", "", {}, None)));
  ASSERT_TRUE(TM);

  Z80Subtarget STI(TM->getTargetTriple(), TM->getTargetCPU(),
                   TM->getTargetCPU(), TM->getTargetFeatureString(), *TM);
  bool Is24Bit = STI.is24Bit();
  auto *TII = STI.getInstrInfo();
  ASSERT_TRUE(TII);

  std::string MIR;
  {
    raw_string_ostream S(MIR);
    int BBCounter = 0;
    Counter BB("bb.", BBCounter);
    S << formatv("--- |\n"
                 "  define void @InstSizes() {{\n"
                 "    ret void\n"
                 "  }\n"
                 "\n"
                 "...\n"
                 "---\n"
                 "name:            InstSizes\n"
                 "body:             |\n"
                 "  {0:+}:\n",
                 BB);
    for (const TestInstr &TI : TestInstrs)
      S << "    "
        << formatv(TI.MIR[Is24Bit], Is24Bit ? 24 : 16, Is24Bit ? 'l' : 's',
                   Is24Bit ? "u" : "", Is24Bit ? "e" : "", BB)
        << '\n';
    S << "\n...\n";
  }

  auto Buffer = MemoryBuffer::getMemBuffer(MIR);
  ASSERT_TRUE(Buffer);

  LLVMContext Context;
  auto Parser = createMIRParser(std::move(Buffer), Context);
  ASSERT_TRUE(Parser);

  auto M = Parser->parseIRModule();
  ASSERT_TRUE(M);

  M->setDataLayout(TM->createDataLayout());
  M->setTargetTriple(TM->getTargetTriple().getTriple());

  MachineModuleInfo MMI(TM.get());
  ASSERT_FALSE(Parser->parseMachineFunctions(*M, MMI));

  auto *F = M->getFunction("InstSizes");
  ASSERT_TRUE(F);
  auto &MF = MMI.getOrCreateMachineFunction(*F);

  ASSERT_EQ(MF.getInstructionCount(), array_lengthof(TestInstrs));
  auto TI = std::begin(TestInstrs);
  for (const auto &MBB : MF)
    for (const auto &MI : MBB) {
      EXPECT_FALSE(MI.isPseudo());
      EXPECT_EQ(TII->getInstSizeInBytes(MI), TI++->Size[Is24Bit]) << MI;
    }
}

} // end anonymous namespace

TEST(InstSizes, Z80) { checkInstructionSizes("z80"); }

TEST(InstSizes, Z180) { checkInstructionSizes("z180"); }

TEST(InstSizes, eZ80_Z80) { checkInstructionSizes("ez80-code16"); }

TEST(InstSizes, eZ80) { checkInstructionSizes("ez80"); }
